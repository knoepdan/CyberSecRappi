# Yara rule "Sample2.exe"

Starting point: unpacked "sample2.exe". 

I test for: 
- filesize (more to play around a bit with yara)
    - Rule is probably not really needed. Maybe helps to reduce false positives
- the anti disassembly/debugging techniques detected
    - changing the values in the stack
        - might be rather stable as it does not specify a value. However, big chance for false positives so it has to be combined with other rules
    - Import of IsDebuggerPresent
        - Check itself should be stable. However, it is not necessarily malicious
    - Overriding exception filter
        - String search of SetUnhandledExceptionFilter
        - Division by zero (register EAX)
            - SetUnhandledExceptionFilter rule is probably rather stable. However, Division could also be achieved by other means or in another register, so this is easily something that might change. I guess there are other ways to trigger an exception. The overriding exception filter rule might have to be adapted. (plus there could be a false positive)

There is a chance for false positives even though multiple conditions have to apply, but I didn't want to add "random" bytes (or the only real user string) to the conditions as these might easily change. However, it would have been good to have some checks on actual malware action.

*Remark: no tests against what the actual exe does because at the time of writing, I did not detect any malicious behavior*


## Execute/Test yara rule

Execution via cmd.

**positive test**
yara64 -r C:\Repos\CyberSecRappi\10_malwareAnalysis\Tasks\sample2.yara "C:\Repos\AnalyzeExe\sample2.exe"


**negative test (some other random file)**
yara64 -r C:\Repos\CyberSecRappi\10_malwareAnalysis\Tasks\sample2.yara "C:\yara-4.3.1-2141-win64\testFile.txt"



## Varia and leftovers


**Website and how to get started**
- https://yara.readthedocs.io/en/stable/gettingstarted.html
- on windows dowload the binaries and then in commandline run: 
    - `yara64 -r testRule.yara "C:\yara-4.3.1-2141-win64\testFile.txt"`  (testRule.yara is the file with yara rules)
- good links
    - https://yara.readthedocs.io/en/stable/writingrules.html
    - https://github.com/Yara-Rules/rules  collection of yara rules


**other good sites**
https://github.com/Yara-Rules/rules/blob/master/antidebug_antivm/antidebug_antivm.yar